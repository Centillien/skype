elgg.provide('elgg.skype');var Skype=new function(){this.name=null;this.element=null;this.participants=["echo123"];this.listParticipants="false";this.video="false";this.topic=null;this.listTopic="false";this.imageSize=null;this.imageColor=null;this.useDetection="true";this.protocol="skype:";this.ui=ui;this.setImageAttributes=setImageAttributes;this.trimString=trimString;this.escapeString=escapeString;this.createDetectionFrame=createDetectionFrame;this.trySkypeUri_IE9_IE8=trySkypeUri_IE9_IE8;this.trySkypeUri_IOS_Safari=trySkypeUri_IOS_Safari;this.trySkypeUri_Android_Firefox=trySkypeUri_Android_Firefox;this.trySkypeUri_Generic=trySkypeUri_Generic;this.SkypeClientDownloadUrl="http://www.skype.com/download";this.installSkypeMsg="Please install Skype application in order to make this call or send a message.";this.displayNotSupportedMsg=displayNotSupportedMsg;this.SkypeUriAssetMap=SkypeUriAssetMap;this.SkypeUriAssetColorMap=SkypeUriAssetColorMap;this.SkypeUriNameLinks=SkypeUriNameLinks;this.assetPrefix="http://cdn.dev.skype.com/uri/";this.assetSizeArray=[10,12,14,16,32];this.assetSizeDefault=16;this.assetMarginMinimum=16;this.assetSize=this.assetSizeDefault;this.assetMargin=(this.assetSize>=this.assetMarginMinimum)?this.assetSize:this.assetMarginMinimum;this.assetColorPathWhite="_trans_";this.assetColorFontWhite="white";this.assetColorPathSkype="_";this.assetColorFontSkype="#444444";this.assetColorPathDefault=this.assetColorPathSkype;this.assetColorFontDefault=this.assetColorFontSkype;this.assetColor=new this.SkypeUriAssetColorMap(this.assetColorPathDefault,this.assetColorFontDefault);this.assetSizeMap=new Object();this.assetSizeMap.size10=new this.SkypeUriAssetMap(10,-19);this.assetSizeMap.size12=new this.SkypeUriAssetMap(12,-20);this.assetSizeMap.size14=new this.SkypeUriAssetMap(14,-20);this.assetSizeMap.size16=new this.SkypeUriAssetMap(16,-20);this.assetSizeMap.size32=new this.SkypeUriAssetMap(32,-41);this.focusLinks=new this.SkypeUriNameLinks("","");this.callLinks=new this.SkypeUriNameLinks("call","");this.videoLinks=new this.SkypeUriNameLinks("call","");this.chatLinks=new this.SkypeUriNameLinks("chat","");this.multiChatLinks=new this.SkypeUriNameLinks("chat","");this.setImageAttributes(this.assetSizeDefault,"");this.analyzeSkypeUriInit=null;this.analyzeSkypeUriAction=null;this.analyzeSkypeUriRedirect=null;this.analyzeCrumbs=[];this.tryAnalyzeSkypeUriInit=tryAnalyzeSkypeUriInit;this.tryAnalyzeSkypeUriAction=tryAnalyzeSkypeUriAction;this.tryAnalyzeSkypeUriRedirect=tryAnalyzeSkypeUriRedirect;this.detectSkypeClientFrameId=null;this.detectedPlatform="unknown";this.detectedBrowser="unknown";this.isWin7=false;this.isWin8=false;this.isOSX_SnowLeopard=false;this.isOSX_MountainLion=false;this.isWinPhone8=false;this.isAndroid=false;this.isAndroid_Gingerbread=false;this.isAndroid_IceCream=false;this.isAndroid_JellyBean=false;this.isIOS6=false;this.isIOS5=false;this.isIOS4=false;this.isIPhone=false;this.isIPad=false;this.isIPod=false;this.isIE10=false;this.isIE9=false;this.isIE8=false;this.isIE7=false;this.isIE6=false;this.isFF=false;this.isAndroidBrowser=false;this.isChrome=false;this.isSafari=false;this.analyzeScript=this.assetPrefix+"skype-analytics.js";this.includeJavascript=includeJavascript;this.includeJavascript(this.analyzeScript);if(navigator.userAgent.indexOf("Windows NT 6.1")!=-1){this.isWin7=true;this.detectedPlatform="Windows 7"}else{if(navigator.userAgent.indexOf("Windows NT 6.2")!=-1){this.isWin8=true;this.detectedPlatform="Windows 8"}else{if(navigator.userAgent.indexOf("Mac OS X 10_7")!=-1){this.isOSX_SnowLeopard=true;this.detectedPlatform="OSX 10.7"}else{if(navigator.userAgent.indexOf("Mac OS X 10.8")!=-1){this.isOSX_MountainLion=true;this.detectedPlatform="OSX 10.8"}else{if(navigator.userAgent.indexOf("Mac OS X 10_8")!=-1){this.isOSX_MountainLion=true;this.detectedPlatform="OSX 10.8"}else{if(navigator.userAgent.indexOf("Windows Phone 8")!=-1){this.isWinPhone8=true;this.detectedPlatform="Windows Phone 8"}else{if(navigator.userAgent.indexOf("Android")!=-1){this.isAndroid=true;this.detectedPlatform="Android"}else{if(navigator.userAgent.indexOf("Android 2.3")!=-1){this.isAndroid_Gingerbread=true;this.detectedPlatform="Android 2.3"}else{if(navigator.userAgent.indexOf("Android 4.0")!=-1){this.isAndroid_IceCream=true;this.detectedPlatform="Android 4.0"}else{if(navigator.userAgent.indexOf("Android 4.1")!=-1){this.isAndroid_JellyBean=true;this.detectedPlatform="Android 4.1"}else{if(navigator.userAgent.match(/OS 6_[0-9_]+ like Mac OS X/i)){this.isIOS6=true;this.detectedPlatform="iOS6"}else{if(navigator.userAgent.match(/OS 5_[0-9_]+ like Mac OS X/i)){this.isIOS5=true;this.detectedPlatform="iOS5"}else{if(navigator.userAgent.match(/OS 4_[0-9_]+ like Mac OS X/i)){this.isIOS4=true;this.detectedPlatform="iOS4"}}}}}}}}}}}}}if(navigator.userAgent.indexOf("iPhone")!=-1){this.isIPhone=true;this.detectedPlatform="iPhone "+this.detectedPlatform}else{if(navigator.userAgent.indexOf("iPad")!=-1){this.IsPad=true;this.detectedPlatform="iPad "+this.detectedPlatform}else{if(navigator.userAgent.indexOf("iPod")!=-1){this.IsPod=true;this.detectedPlatform="iPod "+this.detectedPlatform}}}if(navigator.userAgent.indexOf("MSIE 10")!=-1){this.isIE10=true;this.detectedBrowser="Internet Explorer 10"}else{if(navigator.userAgent.indexOf("MSIE 9")!=-1){this.isIE9=true;this.detectedBrowser="Internet Explorer 9"}else{if(navigator.userAgent.indexOf("MSIE 8")!=-1){this.isIE8=true;this.detectedBrowser="Internet Explorer 8"}else{if(navigator.userAgent.indexOf("MSIE 7")!=-1){this.isIE7=true;this.detectedBrowser="Internet Explorer 7"}else{if(navigator.userAgent.indexOf("MSIE 6")!=-1){this.isIE6=true;this.detectedBrowser="Internet Explorer 6"}else{if(navigator.userAgent.indexOf("Firefox")!=-1){this.isFF=true;this.detectedBrowser="Firefox"}else{if(navigator.userAgent.indexOf("Chrome")!=-1){this.isChrome=true;this.detectedBrowser="Chrome"}else{if(navigator.userAgent.indexOf("Mobile Safari")!=-1&&this.isAndroid){this.isAndroidBrowser=true;this.detectedBrowser="Mobile Safari"}else{if(navigator.userAgent.indexOf("Safari")!=-1){this.isSafari=true;this.detectedBrowser="Safari"}}}}}}}}}if(this.isAndroid){this.SkypeClientDownloadUrl="market://details?id=com.skype.raider"}else{if(this.isIOS6||this.isIOS5||this.isIOS4){this.SkypeClientDownloadUrl="itms-apps://itunes.com/apps/skype"}}function displayNotSupportedMsg(){alert("Sorry this device doesn't support Skype Buttons yet. Please add "+this.participants[0]+" as a contact in your Skype Client to MAKE this call.")}function tryAnalyzeSkypeUriInit(){if(!this.analyzeSkypeUriInit&&typeof analyzeSkypeUriInit=="function"){this.analyzeSkypeUriInit=analyzeSkypeUriInit}if(typeof this.analyzeSkypeUriInit=="function"){this.analyzeSkypeUriInit()}else{var _t={};_t.prop1="type: init (pre script load)";_t.prop2="domain: "+document.domain;_t.prop3="image size / color: "+this.imageSize+" / "+this.imageColor;_t.prop4="video / list participants / list topic: "+this.video+" / "+this.listParticipants+" / "+this.listTopic;_t.prop5="target(s): "+this.participants;_t.prop6="user agent: "+navigator.userAgent;_t.prop7="app version: "+navigator.appVersion;_t.prop8="detected platform: "+this.detectedPlatform;_t.prop9="detected browser: "+this.detectedBrowser;this.analyzeCrumbs.push(_t)}}function tryAnalyzeSkypeUriAction(){if(!this.analyzeSkypeUriAction&&typeof analyzeSkypeUriAction=="function"){this.analyzeSkypeUriAction=analyzeSkypeUriAction}if(typeof this.analyzeSkypeUriAction=="function"){this.analyzeSkypeUriAction()}else{var actionType="call";if(this.name=="chat"){actionType="chat"}var _t={};_t.prop1="type: "+actionType+" (pre script load)";_t.prop2="domain: "+document.domain;_t.prop3="image size / color: "+this.imageSize+" / "+this.imageColor;_t.prop4="video / list participants / list topic: "+this.video+" / "+this.listParticipants+" / "+this.listTopic;_t.prop5="target(s): "+this.participants;_t.prop6="user agent: "+navigator.userAgent;_t.prop7="app version: "+navigator.appVersion;_t.prop8="detected platform: "+this.detectedPlatform;_t.prop9="detected browser: "+this.detectedBrowser;this.analyzeCrumbs.push(_t)}}function tryAnalyzeSkypeUriRedirect(){if(!this.analyzeSkypeUriRedirect&&typeof analyzeSkypeUriRedirect=="function"){this.analyzeSkypeUriRedirect=analyzeSkypeUriRedirect}if(typeof this.analyzeSkypeUriRedirect=="function"){this.analyzeSkypeUriRedirect()}else{var _t={};_t.prop1="type: redirect (pre script load)";_t.prop2="domain: "+document.domain;_t.prop3="image size / color: "+this.imageSize+" / "+this.imageColor;_t.prop4="video / list participants / list topic: "+this.video+" / "+this.listParticipants+" / "+this.listTopic;_t.prop5="target(s): "+this.participants;_t.prop6="user agent: "+navigator.userAgent;_t.prop7="app version: "+navigator.appVersion;_t.prop8="detected platform: "+this.detectedPlatform;_t.prop9="detected browser: "+this.detectedBrowser;this.analyzeCrumbs.push(_t)}}function includeJavascript(scriptSrc){var headTag=document.getElementsByTagName("head")[0];var scriptTag=document.createElement("script");scriptTag.setAttribute("type","text/javascript");scriptTag.setAttribute("src",scriptSrc);headTag.appendChild(scriptTag)}function SkypeUriAssetMap(size,verticalOffset){this.size=size;this.verticalOffset=verticalOffset}function SkypeUriAssetColorMap(path,font){this.path=path;this.font=font}function SkypeUriNameLinks(name,linkImage){this.name=name;this.linkImage=linkImage}function ui(skypeUri){if((skypeUri.participants!==undefined)&&(skypeUri.participants!==null)){this.participants=skypeUri.participants}if((skypeUri.listParticipants!==undefined)&&(skypeUri.listParticipants!==null)){this.listParticipants=skypeUri.listParticipants}if((skypeUri.video!==undefined)&&(skypeUri.video!==null)){this.video=skypeUri.video}if((skypeUri.listTopic!==undefined)&&(skypeUri.listTopic!==null)){this.listTopic=skypeUri.listTopic}if((skypeUri.imageSize!==undefined)&&(skypeUri.imageSize!==null)){this.imageSize=skypeUri.imageSize}if((skypeUri.imageColor!==undefined)&&(skypeUri.imageColor!==null)){this.imageColor=skypeUri.imageColor}var tStr;tStr=this.trimString(skypeUri.element);if(tStr.length!==0){var uriParent=document.getElementById(tStr);if(uriParent===null){alert("Sorry! Could not find Skype URI parent element: "+tStr+" ('"+skypeUri.element+"')");return(false)}else{if(((skypeUri.name!==undefined)&&(skypeUri.name!==null))&&((skypeUri.participants===undefined)||(skypeUri.participants===null))){alert('Error! Required member "participants" omitted or specified as null');return(false)}}}else{alert('Error! Required member "element" (Skype URI parent element) omitted or specified as null');return(false)}this.setImageAttributes(skypeUri.imageSize,this.trimString(skypeUri.imageColor));if((skypeUri.protocol!==undefined)&&(skypeUri.protocol!==null)){this.protocol=skypeUri.protocol}var uriStr=this.protocol;var participantsStr="";var participantsIdx=0;var multiParticipants=false;if((skypeUri.participants!==undefined)&&(skypeUri.participants!==null)){while(participantsIdx<skypeUri.participants.length){if(skypeUri.participants[participantsIdx]!==null){tStr=this.trimString(skypeUri.participants[participantsIdx]);if(tStr.length!==0){if(participantsIdx!==0){uriStr+=";";participantsStr+=", ";multiParticipants=true}uriStr+=tStr;participantsStr+=tStr}}participantsIdx++}}var uriName=this.focusLinks.name;var uriLinkImage=this.focusLinks.linkImage;var isExplicitCall=false;tStr=this.trimString(skypeUri.name);if(tStr.length!==0){uriName=tStr;if(uriName===this.callLinks.name){isExplicitCall=true;uriLinkImage=this.callLinks.linkImage}else{if(uriName===this.chatLinks.name){if(multiParticipants){uriLinkImage=this.multiChatLinks.linkImage}else{uriLinkImage=this.chatLinks.linkImage}}else{alert("Unrecognized Skype URI name: "+uriName+" ('"+skypeUri.name+"') -- "+this.callLinks.name+"/"+this.chatLinks.name);return(false)}}uriStr+="?"+uriName}else{if(participantsStr.length>0){uriLinkImage=this.callLinks.linkImage}}if(isExplicitCall){tStr=this.trimString(skypeUri.video);if(tStr==="true"){uriLinkImage=this.videoLinks.linkImage;uriStr+="&video="+tStr}}var topicStr=null;if((multiParticipants)&&((isExplicitCall)||(uriName===this.chatLinks.name))){tStr=this.trimString(skypeUri.topic);if(tStr.length>0){topicStr=tStr;uriStr+="&topic="+escapeString(topicStr)}}if(skypeUri.useDetection==="false"){this.useDetection="false"}var uriAnchor=document.createElement("a");if(!this.useDetection||(!this.isWinPhone8&&this.isIE10)||this.isIE7||this.isIE6){uriAnchor.setAttribute("href",uriStr);uriAnchor.setAttribute("onclick","Skype.tryAnalyzeSkypeUriAction();")}else{if((this.isWinPhone8&&this.isIE10)||(this.isAndroid&&this.isAndroidBrowser)||(this.isAndroid&&this.isChrome)){uriAnchor.setAttribute("href","javascript://");uriAnchor.setAttribute("onclick","Skype.tryAnalyzeSkypeUriAction(); Skype.displayNotSupportedMsg();")}else{tStr="Skype.trySkypeUri_Generic";if(this.isIE9||this.isIE8){tStr="Skype.trySkypeUri_IE9_IE8"}else{if((this.isIOS6||this.isIOS5||this.isOS4)&&this.isSafari){tStr="Skype.trySkypeUri_IOS_Safari"}else{if(this.isAndroid&&this.isFF){tStr="Skype.trySkypeUri_Android_Firefox"}}}if(this.detectSkypeClientFrameId===null){this.createDetectionFrame(uriParent)}uriAnchor.setAttribute("href","javascript://");uriAnchor.setAttribute("onclick","Skype.tryAnalyzeSkypeUriAction();"+(tStr+"('"+uriStr+"', '"+this.detectSkypeClientFrameId+"'); return false;"))}}var uriImage=document.createElement("img");uriImage.setAttribute("src",uriLinkImage);uriImage.setAttribute("alt",uriLinkImage);uriImage.setAttribute("style",("border:0; margin:"+this.assetMargin+"px; vertical-align:"+this.assetSizeMap[("size"+this.assetSize)].verticalOffset+"px"));uriAnchor.appendChild(uriImage);var uriPara=document.createElement("p");uriPara.setAttribute("id",(skypeUri.element+"_paraElement"));uriPara.setAttribute("style",("font-size:"+(this.assetSize-2)+"px; color:"+this.assetColor.font));uriPara.appendChild(uriAnchor);tStr=null;if(participantsStr.length!==0){if(this.trimString(skypeUri.listParticipants)==="true"){tStr=" "+participantsStr}if((topicStr!==null)&&(this.trimString(skypeUri.listTopic)==="true")){if((tStr===null)||(tStr.length===0)){tStr=" RE: "+topicStr}else{tStr+=("; RE: "+topicStr)}}if(tStr===null){tStr=""}uriPara.appendChild(document.createTextNode(tStr))}uriParent.appendChild(uriPara);this.tryAnalyzeSkypeUriInit();return(true)}function setImageAttributes(size,color){this.assetSize=this.assetSizeDefault;this.assetMargin=(this.assetSize>=this.assetMarginMinimum)?this.assetSize:this.assetMarginMinimum;var i;var j=this.assetSizeArray.length;for(i=0;i<j;i++){if(size===this.assetSizeArray[i]){this.assetSize=size;break}}this.assetMargin=(this.assetSize>=this.assetMarginMinimum)?this.assetSize:this.assetMarginMinimum;this.assetColor.path=this.assetColorPathDefault;this.assetColor.font=this.assetColorFontDefault;if(color.length>0){if(color==="skype"){this.assetColor.path=this.assetColorPathSkype;this.assetColor.font=this.assetColorFontSkype}else{if(color==="white"){this.assetColor.path=this.assetColorPathWhite;this.assetColor.font=this.assetColorFontWhite}}}this.focusLinks.linkImage=this.assetPrefix+"Skypeicon"+this.assetColor.path+this.assetSize+"px.png";this.callLinks.linkImage=this.assetPrefix+"callbutton"+this.assetColor.path+this.assetSize+"px.png";this.videoLinks.linkImage=this.assetPrefix+"callbutton"+this.assetColor.path+this.assetSize+"px.png";this.chatLinks.linkImage=this.assetPrefix+"chatbutton"+this.assetColor.path+this.assetSize+"px.png";this.multiChatLinks.linkImage=this.assetPrefix+"chatbutton"+this.assetColor.path+this.assetSize+"px.png"}function trimString(stringToTrim){if((stringToTrim===undefined)||(stringToTrim===null)){return("")}var strLgth=stringToTrim.length;var strIdx=strLgth-1;var foundNonWhiteSpaceChar=false;while((!foundNonWhiteSpaceChar)&&(strLgth>0)){switch(stringToTrim[strIdx]){case" ":case"\t":case"\n":case"\r":strLgth--;break;default:foundNonWhiteSpaceChar=true;break}strIdx--}if(strLgth>0){return(stringToTrim.substr(0,strLgth))}return("")}function escapeString(stringToEscape){if((stringToEscape===undefined)||(stringToEscape===null)){return("")}var escapedStr=stringToEscape.replace(/\s/g,"%20");escapedStr=escapedStr.replace(/:/g,"%3A");escapedStr=escapedStr.replace(/\x2F/g,"%2F");return(escapedStr.replace(/\x5C/g,"%5C"))}function createDetectionFrame(parentElement){var d=new Date();this.detectSkypeClientFrameId="_detectSkypeClient_"+d.getTime().toString();var uriFrame=document.createElement("iframe");uriFrame.setAttribute("style","display:none;");uriFrame.setAttribute("id",this.detectSkypeClientFrameId);parentElement.appendChild(uriFrame)}function trySkypeUri_IE9_IE8(skypeUriString){var t__skypeExists=false;var t__detectionWindow=window.open("","_blank","width=100, height=100");var uriFrame=t__detectionWindow.document.createElement("iframe");uriFrame.setAttribute("src",skypeUriString);t__detectionWindow.document.body.appendChild(uriFrame);setTimeout(function(){try{t__detectionWindow.location.href;t__skypeExists=true}catch(e){}if(t__skypeExists){t__detectionWindow.setTimeout("window.close()",10)}else{t__detectionWindow.close();alert(Skype.installSkypeMsg);Skype.tryAnalyzeSkypeUriRedirect();window.location=Skype.SkypeClientDownloadUrl}},100)}function trySkypeUri_IOS_Safari(skypeUriString,frameId){var t_frame=document.getElementById(frameId);var t_focus=true;window.addEventListener("pagehide",function(){t_focus=false},false);if(t_frame!==null){t_frame.src=skypeUriString}setTimeout(function(){if(t_focus){alert(Skype.installSkypeMsg);Skype.tryAnalyzeSkypeUriRedirect();window.location=Skype.SkypeClientDownloadUrl}},2000)}function trySkypeUri_Android_Firefox(skypeUriString,frameId){var isSupported=false;var t_frame=document.getElementById(frameId);if(t_frame!==null){try{t_frame.contentWindow.location.href=skypeUriString;isSupported=true}catch(e){isSupported=false}}setTimeout(function(){if(!isSupported){alert(Skype.installSkypeMsg);Skype.tryAnalyzeSkypeUriRedirect();window.location=Skype.SkypeClientDownloadUrl}},2000)}function trySkypeUri_Generic(skypeUriString,frameId){var t_focus=true;window.onblur=function(){t_focus=false};var t_frame=document.getElementById(frameId);if(t_frame!==null){t_frame.src=skypeUriString}setTimeout(function(){if(t_focus){alert(Skype.installSkypeMsg);Skype.tryAnalyzeSkypeUriRedirect();window.location=Skype.SkypeClientDownloadUrl}},2000)}};
